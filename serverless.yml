service: Hotel-API

plugins:
  - serverless-dotenv-plugin
  - serverless-openapi-documentation

provider:
  name: aws
  runtime: nodejs20.x
  region: eu-north-1
  profile: ${env:PROFILE}
  iam:
    role: ${env:IAM_Role}

functions:
  DeleteBookings:
    handler: functions/DeleteBookings/index.handler
    events:
      - httpApi:
          path: /bookings/{id}
          method: delete
          documentation:
            summary: "Delete a booking"
            description: "Deletes a specific booking using its unique ID."
            pathParams:
              - name: "id"
                description: "Unique ID for the booking to be deleted."
            methodResponses:
              - statusCode: "204"
                responseBody:
                  description: "The booking has been deleted."
              - statusCode: "404"
                responseModels:
                  "application/json": "ErrorResponse"

  GetBookings:
    handler: functions/GetBookings/index.handler
    events:
      - httpApi:
          path: /bookings
          method: get
          documentation:
            summary: "Get all bookings"
            description: "Returns a list of all existing bookings."
            methodResponses:
              - statusCode: "200"
                responseBody:
                  description: "A list of bookings."
                responseModels:
                  "application/json":
                    type: array
                    items:
                      $ref: "#/components/schemas/Booking"

  PostBookings:
    handler: functions/PostBooking/index.handler
    events:
      - httpApi:
          path: /bookings
          method: post
          documentation:
            summary: "Create a new booking"
            description: "Creates a new booking for a room."
            requestBody:
              description: "Information for creating a new booking."
            requestModels:
              "application/json": "CreateBookingRequest"
            methodResponses:
              - statusCode: "201"
                responseBody:
                  description: "Confirmation that the booking has been created."
                responseModels:
                  "application/json": "Booking"
              - statusCode: "400"
                responseModels:
                  "application/json": "ErrorResponse"

  PostRooms:
    handler: functions/PostRooms/index.handler
    events:
      - httpApi:
          path: /rooms
          method: post
          documentation:
            summary: "Create a new room"
            description: "Adds a new hotel room to the system."
            requestBody:
              description: "Information about the new room."
            requestModels:
              "application/json": "CreateRoomRequest"
            methodResponses:
              - statusCode: "201"
                responseBody:
                  description: "Confirmation that the room has been created."
                responseModels:
                  "application/json": "Room"
              - statusCode: "400"
                responseModels:
                  "application/json": "ErrorResponse"

# ---------------------------------------------------------------------------
# --- IMPORTANT: This section is required for the documentation ---
# ---------------------------------------------------------------------------
custom:
  documentation:
    version: "1.0.0"
    title: "Hotel Booking API"
    description: "API for managing bookings and rooms in a hotel."
    models:
      # Defines the error response model
      - name: "ErrorResponse"
        contentType: "application/json"
        schema:
          type: "object"
          properties:
            message:
              type: "string"

      # Model for creating a room
      - name: "CreateRoomRequest"
        contentType: "application/json"
        schema:
          type: "object"
          properties:
            roomName:
              type: "string"
            capacity:
              type: "integer"
          required:
            - roomName

      # Model for a complete room object (as returned)
      - name: "Room"
        contentType: "application/json"
        schema:
          type: "object"
          properties:
            roomId:
              type: "string"
            roomName:
              type: "string"
            capacity:
              type: "integer"

      # Model for creating a booking
      - name: "CreateBookingRequest"
        contentType: "application/json"
        schema:
          type: "object"
          properties:
            roomId:
              type: "string"
            checkInDate:
              type: "string"
              format: "date"
            checkOutDate:
              type: "string"
              format: "date"
          required:
            - roomId
            - checkInDate
            - checkOutDate

      # Model for a complete booking object (as returned)
      - name: "Booking"
        contentType: "application/json"
        schema:
          type: "object"
          properties:
            bookingId:
              type: "string"
            roomId:
              type: "string"
            checkInDate:
              type: "string"
              format: "date"
            checkOutDate:
              type: "string"
              format: "date"
# ---------------------------------------------------------------------------
# --- IMPORTANT: This section is required for the documentation ---
# ---------------------------------------------------------------------------

# resources
resources:
  Resources:
    HotellBookingTables:
      Type: AWS::DynamoDB::Table
      Properties:
        TableName: hotell-Bookings
        AttributeDefinitions:
          - AttributeName: roomId
            AttributeType: S
          - AttributeName: bookingId
            AttributeType: S
        KeySchema:
          - AttributeName: roomId
            KeyType: HASH
          - AttributeName: bookingId
            KeyType: RANGE
        BillingMode: PAY_PER_REQUEST
        GlobalSecondaryIndexes:
          - IndexName: BookingIdIndex
            KeySchema:
              - AttributeName: bookingId
                KeyType: HASH
            Projection:
              ProjectionType: ALL
    HotellRoomsTable:
      Type: AWS::DynamoDB::Table
      Properties:
        TableName: hotell-Rooms
        AttributeDefinitions:
          - AttributeName: roomId
            AttributeType: S
        KeySchema:
          - AttributeName: roomId
            KeyType: HASH
        BillingMode: PAY_PER_REQUEST
